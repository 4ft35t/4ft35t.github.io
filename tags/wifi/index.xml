<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>wifi on 4ft35t blog</title><link>https://4ft35t.github.io/tags/wifi/</link><description>Recent content in wifi on 4ft35t blog</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 04 Dec 2022 17:57:03 +0800</lastBuildDate><atom:link href="https://4ft35t.github.io/tags/wifi/index.xml" rel="self" type="application/rss+xml"/><item><title>低成本 mesh 组网</title><link>https://4ft35t.github.io/post/lowcast-mesh/</link><pubDate>Sun, 04 Dec 2022 17:57:03 +0800</pubDate><guid>https://4ft35t.github.io/post/lowcast-mesh/</guid><description>&lt;p>上一次主动看 mesh 路由，单台成本 2000 左右，最近在什么值得买上看到用网件6300V2刷机后租mesh的，二手价格单台不到80，立马买两台来组网。&lt;/p>
&lt;h2 id="硬件成本">硬件成本&lt;/h2>
&lt;p>自有一台服役多年的 6300V2, 淘宝新买2台二手，77.99 一台包邮。&lt;/p>
&lt;h2 id="刷机">刷机&lt;/h2>
&lt;h3 id="1-从官方固件刷梅林">1. 从官方固件刷梅林&lt;/h3>
&lt;p>下载 380 版本梅林固件，https://fw.koolcenter.com/KoolCenter_Merlin_Legacy_380/Netgear/R6300V2/X7.9.1/R6300V2_380.70_0-X7.9.1-koolshare.chk&lt;/p>
&lt;p>路由器恢复出厂设置:&lt;/p>
&lt;p>路由器关机，按住reset开机，15秒后松开&lt;/p>
&lt;p>浏览器打开 192.168.1.1，admin/password 登录，固件升级选择 R6300V2_380.70_0-X7.9.1-koolshare.chk&lt;/p>
&lt;h3 id="2-备份-cfe-和-board_data">2. 备份 CFE 和 board_data&lt;/h3>
&lt;p>刷梅林 380 版本后，路由器地址变成 192.168.50.1。登录路由器, 帐号密码沿用 admin/password, 打开 SSH 服务&lt;/p>
&lt;p>系统管理 - 系统设置 - 启用 SSH- LAN only - 应用本页面设置&lt;/p>
&lt;p>使用 ssh 登录路由器，Windows 可以用 putty 或者 wsl。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">dd &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>/dev/mtd0 &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>/tmp/backup_cfe.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dd &lt;span class="k">if&lt;/span>&lt;span class="o">=&lt;/span>/dev/mtd4 &lt;span class="nv">of&lt;/span>&lt;span class="o">=&lt;/span>/tmp/backup_board_data.bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>使用 scp 把 上面两个文件拖回本地，如果需要就砖会用到。&lt;/p>
&lt;p>如果遇到 &lt;code>/usr/libexec/sftp-server: not found&lt;/code> 错误，是因为本地的 scp 版本太新，加 &lt;code>-O&lt;/code> 参数即可&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">scp -O admin@192.168.50.1:/tmp/backup_cfe.bin .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="3-刷-cfe">3. 刷 CFE&lt;/h3>
&lt;p>下载 CEF &lt;a class="link" href="https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_384/NETGEAR/R6300v2/tools/cfe_2.4Gfix.bin" target="_blank" rel="noopener"
>https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_384/NETGEAR/R6300v2/tools/cfe_2.4Gfix.bin&lt;/a>&lt;/p>
&lt;p>下载 CEF 修改器 &lt;a class="link" href="https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_384/NETGEAR/R6300v2/tools/CFEEdit.exe" target="_blank" rel="noopener"
>https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_384/NETGEAR/R6300v2/tools/CFEEdit.exe&lt;/a>&lt;/p>
&lt;p>打开 CFEEdit.exe, 把 MAC 地址修改成华硕的地址段&lt;/p>
&lt;p>需要修改五个位置&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">et0macaddr=00:90:4C:0F:F1:A7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0:macaddr=00:90:4C:0F:F1:A7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1:macaddr=00:90:4C:0F:F1:AB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">secret_code=73210917
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">odmpid=RT-AC68U
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>另存为 cfe-1.bin&lt;/p>
&lt;p>继续修改，把上面内容 MAC 地址中倒数第二段的 &lt;code>F1&lt;/code> 分别修改成 &lt;code>F2&lt;/code> 和 &lt;code>F3&lt;/code>，同时 &lt;code>secret_code&lt;/code> 最后的 &lt;code>17&lt;/code> 改成 &lt;code>27&lt;/code> 和 &lt;code>37&lt;/code>, 另存为 cfe-2.bin 和 cfe-3.bin， 分别对应三台机器。&lt;/p>
&lt;p>scp 把 CFE 传送到路由器&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">scp -O cfe-1.bin admin@192.168.50.1:/tmp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ssh 登陆路由器，开始刷 CFE&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">dd if=/tmp/cfe-1.bin of=/dev/mtd0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nvram erase
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启后路由器会进入 tftp 刷机状态，ip 为 192.168.1.1&lt;/p>
&lt;h3 id="4-tftp-刷入梅林-386-版本">4. tftp 刷入梅林 386 版本&lt;/h3>
&lt;p>下载 386 版本固件 &lt;a class="link" href="https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_386/Netgear/R6300v2/RT-AC6300v2_386.2_4-20210628-91625500b.trx" target="_blank" rel="noopener"
>https://fw.koolcenter.com/KoolCenter_Merlin_New_Gen_386/Netgear/R6300v2/RT-AC6300v2_386.2_4-20210628-91625500b.trx&lt;/a>&lt;/p>
&lt;p>Windows 电脑安装自带的 tftp 客户端&lt;/p>
&lt;p>Win+r - 输入 appwiz.cpl - 打开或关闭Windows功能 - 勾选TFTP客户端 - 重启&lt;/p>
&lt;p>打开一个 cmd 窗口，执行 &lt;code>ping -t 192.168.1.1&lt;/code> 观察 TTL，TTL 值为 100 即表示路由器处于 tftp 刷机状态，如果不是 100，重启路由器
打开第二个 cmd 窗口, 执行 &lt;code>tftp -i 192.168.1.1 put RT-AC6300v2_386.2_4-20210628-91625500b.trx&lt;/code>&lt;/p>
&lt;p>等 tftp 传输完成后，路由器会在3分钟内重启多次，最后完成刷机。&lt;/p>
&lt;p>当 ping 的 TTL 变成 64， 即表示路由器正常启动。如果 tftp 传输完成后5分钟，TTL 还没变成 64，重启路由器。&lt;/p>
&lt;p>如果重启后 ping TTL 值一直保持 100，浏览器访问 192.168.1.1， 进入 CFE miniWeb，点击 &amp;ldquo;Restore default NVRAM values&amp;rdquo;, 然后重启。&lt;/p>
&lt;h3 id="4-刷机后存在问题">4. 刷机后存在问题&lt;/h3>
&lt;p>刷机后，WAN 口的位置会发生变化&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">+------+------+------+------+ +------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| LAN4 |LAN3 | LAN2 | LAN1 | | WAN |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+------+------+------+ +------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+------+------+------+ +------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| WAN |LAN1 |LAN2 |LAN3 | |LAN4 |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">| | | | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+------+------+------+------+ +------+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="mesh-组网">mesh 组网&lt;/h2>
&lt;p>路由1 做为 mesh 路由，访问 192.168.1.1，按向导完成 pppoe 拨号设置, 选路由器模式。&lt;/p>
&lt;p>路由器2，作为 AiMesh 节点，按向导完成动态动态 IP 设置；然后&lt;/p>
&lt;p>系统管理 - 操作模式 - AiMesh 节点 - 保存&lt;/p>
&lt;p>等界面显示重置完成，路由器2的设置完成。&lt;/p>
&lt;p>现在电脑网线连接路由器1；路由器2保持开机，不插网线，放在路由器1旁边。&lt;/p>
&lt;p>登录路由器1网页 - AiMesh - 添加 AiMesh 节点 - 选择路由器2（RT-AC86U） - 建立连接&lt;/p>
&lt;p>等待完成后对路由器3重复执行上述操作。&lt;/p>
&lt;p>所有操作完成后，路由器2和3的用户名密码会变成和路由器1一样。&lt;/p>
&lt;p>现在可以享受 mesh 组网的无缝切换了，不用再像用扩展器一样手动切换。&lt;/p>
&lt;h3 id="有线回程">有线回程&lt;/h3>
&lt;p>路由器1 LAN 连接路由器2 WAN，即可让路由器2 变成有线回程。路由器3 同理。&lt;/p>
&lt;h2 id="参考链接">参考链接&lt;/h2>
&lt;ul>
&lt;li>&lt;a class="link" href="https://post.smzdm.com/p/a4dk3zgk/" target="_blank" rel="noopener"
>最便宜的组Aimesh的方案——R6300V2最后的荣光&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.right.com.cn/forum/thread-7613019-1-1.html" target="_blank" rel="noopener"
>网件NETGEAR R6300V2(国行版本) 原厂固件直刷380_X7.9.1梅林成功 附升级梅林386教程 &lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://wkings.blog/archives/875" target="_blank" rel="noopener"
>网件路由器 R6300v2 刷机教程和固件大全&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://zhuanlan.zhihu.com/p/386867842" target="_blank" rel="noopener"
>无线路由器Mesh组网教程：华硕Aimesh组网篇&lt;/a>&lt;/li>
&lt;/ul></description></item></channel></rss>