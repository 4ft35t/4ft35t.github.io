<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='使用 rclone 中转 Onedrive WebDAV'><title>群晖使用 A1 订阅版 Onedrive</title>
<link rel=canonical href=https://4ft35t.github.io/post/use-office365-a1-onedrive-in-synology/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property='og:title' content='群晖使用 A1 订阅版 Onedrive'><meta property='og:description' content='使用 rclone 中转 Onedrive WebDAV'><meta property='og:url' content='https://4ft35t.github.io/post/use-office365-a1-onedrive-in-synology/'><meta property='og:site_name' content='4ft35t blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='office365'><meta property='article:tag' content='onedrive'><meta property='article:tag' content='webdav'><meta property='article:tag' content='docker'><meta property='article:tag' content='rclone'><meta property='article:tag' content='sharepoint'><meta property='article:published_time' content='2024-03-19T11:22:46+08:00'><meta property='article:modified_time' content='2024-03-19T11:22:46+08:00'><meta name=twitter:title content="群晖使用 A1 订阅版 Onedrive"><meta name=twitter:description content="使用 rclone 中转 Onedrive WebDAV"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9669039894343567" crossorigin=anonymous></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>4ft35t blog</a></h1><h2 class=site-description>随手折腾，顺手记录</h2></div></header><ol class=menu id=main-menu><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/index.xml target=_blank><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg>
<span>RSS</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://4ft35t.github.io/ selected>中文</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></div></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/network/>Network</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/use-office365-a1-onedrive-in-synology/>群晖使用 A1 订阅版 Onedrive</a></h2><h3 class=article-subtitle>使用 rclone 中转 Onedrive WebDAV</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-03-19</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 2 分钟</time></div></footer></div></header><section class=article-content><p>教育版 A1 订阅的 Onedrive 可以用 rclone 以 webdav 方式挂载。 但这不是标准的 webdav 协议，无法在群晖中使用。</p><p>群晖的 Cloud Sync 支持同步 Microsoft OneDrive for Business 和 Microsoft SharePoint，但是这个帐号使用 edu 邮箱自己注册的，没有管理员，登陆后报错</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;error&#34;</span><span class=p>:</span><span class=s2>&#34;invalid_client&#34;</span><span class=p>,</span><span class=nt>&#34;error_description&#34;</span><span class=p>:</span><span class=s2>&#34;AADSTS650051: Using application &#39;Cloud Sync&#39; is currently not supported for your organization xxx.edu.cn because it is in an unmanaged state. An administrator needs to claim ownership of the company by DNS validation of xxx.edu.cn before the application Cloud Sync can be provisioned. Trace ID: a4ec2174-8d9f-4281-9f5b-7d782c060601 Correlation ID: c6bdc0ff-5a6c-4597-9060-af9c981610e2 Timestamp: 2024-03-15 02:00:57Z&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=实现方案>实现方案</h2><h3 id=skleeschultebasic-to-sharepoint-auth-http-proxy-方案>skleeschulte/basic-to-sharepoint-auth-http-proxy 方案</h3><p>使用 <a class=link href=https://github.com/skleeschulte/basic-to-sharepoint-auth-http-proxy target=_blank rel=noopener>https://github.com/skleeschulte/basic-to-sharepoint-auth-http-proxy</a> 中转请求，最终以 webdav 协议使用。</p><h3 id=rclone-方案>rclone 方案</h3><p>rclone 也是转为 webdav 服务</p><p><code>rclone serve webdav remote:path [flags]</code></p><h3 id=方案效果对比>方案效果对比</h3><div class=table-wrapper><table><thead><tr><th>应用程序</th><th>basic-to-sharepoint-auth-http-proxy</th><th>rclone</th></tr></thead><tbody><tr><td>File Station</td><td>N</td><td>Y</td></tr><tr><td>Cloud Sync</td><td>Y</td><td>Y</td></tr><tr><td>Hyper Backup</td><td>Y</td><td>Y</td></tr></tbody></table></div><p>对比后 rclone 方案有明显优势:</p><ol><li>支持在 File Station 挂载</li><li>rclone 是是个活跃项目，basic-to-sharepoint-auth-http-proxy 已经 2 年无更新</li></ol><h2 id=操作方法>操作方法</h2><h3 id=basic-to-sharepoint-auth-http-proxy-方案>basic-to-sharepoint-auth-http-proxy 方案</h3><p><code>sudo docker run --name sharepoint-proxy -d -p 13000:3000 -e PROXY_TARGET=https://xxx-my.sharepoint.com/ --restart always skleeschulte/basic-to-passport-auth-http-proxy:v0.1.4</code></p><p>之后 webdav url 是 http://127.0.0.1:13000/personal/[YOUR-EMAIL]/Documents, 用户名和密码是 onedrive 的信息。</p><h3 id=rclone-方案-1>rclone 方案</h3><p>rclone 我本地也在用，没用 docker。</p><h4 id=1-配置-rclone-访问-onedrive>1. 配置 rclone 访问 onedrive</h4><p>教育版 Onedrive 登陆后的地址是 <code>https://[YOUR-DOMAIN]-my.sharepoint.com/personal/[YOUR-EMAIL]/_layouts/15/onedrive.aspx</code>, 只需要把 <code>_layouts/15/onedrive.aspx</code> 换成 <code>Documents</code> 就是 webdav 地址。</p><p><code>rclone confige - n) New remote - 随便起个名字 - 51 / WebDAV - https://[YOUR-DOMAIN]-my.sharepoint.com/personal/[YOUR-EMAIL]/Documents - 4 / Sharepoint Online, authenticated by Microsoft account - 用户名 - y) Yes, type in my own password - 密码 - 确认密码 - 回车跳过 - y) Yes this is OK (default)</code></p><h4 id=2-rclone-开启-webadv-服务>2. rclone 开启 webadv 服务</h4><p>以上一步起的名字 1dr-sharepoint 为例, 执行下面命令即可开启 webdav 服务。
<code>rclone rclone serve webdav 1dr-sharepoint:/ --user user --pass password --addr 192.168.1.101:8080</code></p><p>webdav url http://192.168.1.101:8080/</p><p>rclone 支持开启的服务列表如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>  dlna        Serve remote:path over DLNA
</span></span><span class=line><span class=cl>  docker      Serve any remote on docker<span class=s1>&#39;s volume plugin API.
</span></span></span><span class=line><span class=cl><span class=s1>  ftp         Serve remote:path over FTP.
</span></span></span><span class=line><span class=cl><span class=s1>  http        Serve the remote over HTTP.
</span></span></span><span class=line><span class=cl><span class=s1>  nfs         Serve the remote as an NFS mount
</span></span></span><span class=line><span class=cl><span class=s1>  restic      Serve the remote for restic&#39;</span>s REST API.
</span></span><span class=line><span class=cl>  s3          Serve remote:path over s3.
</span></span><span class=line><span class=cl>  sftp        Serve the remote over SFTP.
</span></span><span class=line><span class=cl>  webdav      Serve remote:path over WebDAV.
</span></span></code></pre></td></tr></table></div></div><h4 id=3-群晖-file-station-挂载>3. 群晖 File Station 挂载</h4><p>File Station - Tools - Remote Connection - Connection Setup - WebDAV</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ip: 192.168.1.101
</span></span><span class=line><span class=cl>port: 8080
</span></span><span class=line><span class=cl>path: /
</span></span><span class=line><span class=cl>account name: user
</span></span><span class=line><span class=cl>passowrd: pssword
</span></span></code></pre></td></tr></table></div></div><h2 id=参考链接>参考链接</h2><ul><li><a class=link href=https://blog.edmond.work/2023/02/19/dsm-hyper-backup-onedrive-%E5%82%99%E4%BB%BD%E6%95%99%E5%AD%B8/ target=_blank rel=noopener>DSM Hyper Backup OneDrive 備份教學</a></li><li><a class=link href=https://hostloc.com/thread-785905-1-1.html target=_blank rel=noopener>使群晖 CloudSync 支持同步世纪互联 OneDrive</a></li><li><a class=link href=https://tongjunsz.gitee.io/2020/10/29/%E9%80%9A%E8%BF%87Synology%E7%9A%84Hyper-Backup%E5%A4%87%E4%BB%BD%E5%88%B0Microsoft-OneDrive-for-Business-SharePoint/ target=_blank rel=noopener>通过synology的hyper backup备份到microsoft onedrive for business（sharepoint)</a></li><li><a class=link href=https://blog.ty-wu.com/posts/synohyperbksharepoint/ target=_blank rel=noopener>Synology Hyper Backup 備份到 OneDrive</a></li><li><a class=link href=https://rclone.org/webdav/ target=_blank rel=noopener>WebDAV</a></li><li><a class=link href=https://rclone.org/commands/rclone_serve_webdav/ target=_blank rel=noopener>rclone serve webdav</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/office365/>Office365</a>
<a href=/tags/onedrive/>Onedrive</a>
<a href=/tags/webdav/>Webdav</a>
<a href=/tags/docker/>Docker</a>
<a href=/tags/rclone/>Rclone</a>
<a href=/tags/sharepoint/>Sharepoint</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><script src=https://utteranc.es/client.js repo=4ft35t/4ft35t.github.io issue-term=pathname crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(e){let t=document.querySelector(".utterances iframe");t&&t.contentWindow.postMessage({type:"set-theme",theme:`github-${e}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 4ft35t blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#实现方案>实现方案</a><ol><li><a href=#skleeschultebasic-to-sharepoint-auth-http-proxy-方案>skleeschulte/basic-to-sharepoint-auth-http-proxy 方案</a></li><li><a href=#rclone-方案>rclone 方案</a></li><li><a href=#方案效果对比>方案效果对比</a></li></ol></li><li><a href=#操作方法>操作方法</a><ol><li><a href=#basic-to-sharepoint-auth-http-proxy-方案>basic-to-sharepoint-auth-http-proxy 方案</a></li><li><a href=#rclone-方案-1>rclone 方案</a><ol><li><a href=#1-配置-rclone-访问-onedrive>1. 配置 rclone 访问 onedrive</a></li><li><a href=#2-rclone-开启-webadv-服务>2. rclone 开启 webadv 服务</a></li><li><a href=#3-群晖-file-station-挂载>3. 群晖 File Station 挂载</a></li></ol></li></ol></li><li><a href=#参考链接>参考链接</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>